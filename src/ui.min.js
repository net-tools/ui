window.nettools=window.nettools||{};nettools.ui=nettools.ui||{};nettools.ui.SimpleMenu=class{constructor(items=[],options={}){this._items=items;this._options=options;this._node=null;this._options.onCustomize=this._options.onCustomize||null}
static image(img,title=''){return `<img src="${img}" title="${title}">`}
get node(){return this._node}
get items(){return this._items}
set items(items=[]){this._items=items;this.update()}
update(){this.customize();this.build()}
customize(){if(typeof this._options.onCustomize==='function')
this._options.onCustomize.call(this);}
customizeNode(node,item){}
build(){this.destroy();this.create()}
create(){var __urlHandler=function(item){var url=item.url.href;if(item.url.csrf)
url=nettools.jscore.SecureRequestHelper.addCSRFSubmittedValue(url);if(item.url.target=='_blank')
window.open(url,item.id);else document.location=url}
this._node=document.createElement('UL');this._node.classList.add('uiSimpleMenu');for(var i=0;i<this._items.length;i++){var item=this._items[i];var li=document.createElement('LI');li.menuObject=this;if(item){li.innerHTML=item.title||'';li.id=item.id||'';if(item.disabled)
li.setAttribute('data-disabled','true');else{if(item.url&&item.url.href)
li.addEventListener('click',__urlHandler.bind(li,item));if(item.onclick)
li.addEventListener('click',item.onclick);}}else{li.setAttribute('data-separator','true')}
this.customizeNode(li,item);this._node.appendChild(li)}}
destroy(){if(this._node){this._node.parentNode.removeChild(this._node);this._node=null}}}
nettools.ui.PopupMenu=class extends nettools.ui.SimpleMenu{constructor(items=[],options={}){super(items,options);this.target=null;if(this._options.attachTo)
this.attach(this._options.attachTo);}
onPopupEvent(event){this.popup(event.target,event.offsetX,event.offsetY);event.preventDefault()}
attach(node){if((node.constructor.name!='Array')&&(node.constructor.name!='NodeList'))
node=[node];var that=this;node.forEach(function(n){n.addEventListener('contextmenu',that.onPopupEvent.bind(that));n.classList.add('uiSimpleMenuTarget')})}
onMouseLeave(event){this.target=null;this.destroy()}
create(){super.create();this._node.addEventListener('mouseleave',this.onMouseLeave.bind(this));this._node.addEventListener('click',this.onMouseLeave.bind(this))}
popup(target,x,y){this.target=target;this.update();this._node.style.left=x-2+'px';this._node.style.top=y-2+'px';target.appendChild(this._node)}}
nettools.ui.FloatingMenu=class extends nettools.ui.SimpleMenu{constructor(items=[],options={}){super(items,options);if(this._options.attachTo)
this.attach(this._options.attachTo);}
attach(node){node.classList.add('uiSimpleMenuTarget');this.show(node)}
show(node){this.update();switch(this._options.position){case nettools.ui.FloatingMenu.TOP_LEFT:this._node.style.left=0;this._node.style.top=0;break;case nettools.ui.FloatingMenu.BOTTOM_LEFT:this._node.style.left=0;this._node.style.bottom=0;break;case nettools.ui.FloatingMenu.BOTTOM_RIGHT:this._node.style.right=0;this._node.style.bottom=0;break;case nettools.ui.FloatingMenu.TOP_RIGHT:default:this._node.style.right=0;this._node.style.top=0;break}
node.appendChild(this._node)}}
nettools.ui.FloatingMenu.TOP_LEFT=1;nettools.ui.FloatingMenu.TOP_RIGHT=2;nettools.ui.FloatingMenu.BOTTOM_LEFT=3;nettools.ui.FloatingMenu.BOTTOM_RIGHT=4;nettools.ui.RequestFeedback=class extends nettools.jscore.RequestFeedback{constructor(params,onfeedback,onload,onabort){super(onfeedback,onload,onabort);params=params||{};this.context=params.context||document;this.loadMessage=params.loadmsg;this.node=null}
feedback(pct){this.createFeedbackUI();if(this.node.firstChild)
this.node.firstChild.innerHTML=pct+'%';super.feedback(pct)}
abort(){this.hideFeedbackUI();alert(nettools.ui.RequestFeedback.i18n.ABORT_MSG);super.abort()}
load(){this.hideFeedbackUI();if(this.loadMessage)
alert(this.loadMessage);super.load()}
createFeedbackUI(){if(!this.node){this.node=this.context.createElement('div');this.node.className='uiRequestFeedback';this.node.innerHTML='<span></span>';this.context.body.insertBefore(this.node,this.context.body.firstChild)}}
hideFeedbackUI(){if(this.node){this.node.parentNode.removeChild(this.node);this.node=null}}}
nettools.ui.RequestFeedback.i18n={ABORT_MSG:'An error occured during request data upload'}
nettools.ui.Size=class{constructor(s){if(s==null){this.size=null;this.unit=null;return}
if(s instanceof nettools.ui.Size){this.size=s.size;this.unit=s.unit;return}
var regs=null;if(regs=(s).toString().match(/^([0-9]+)([a-z]+)$/)){this.size=parseInt(regs[1]);this.unit=String(regs[2])}else{this.size=parseInt(s);this.unit='px'}}
isNull(){return(this.size==null)}
isPositive(){return(this.size>=0)}
isNegative(){return(this.size<0)}
negate(){if(this.isNull())
return new nettools.ui.Size(null);return new nettools.ui.Size((-this.size)+this.unit)}
abs(){if(this.isNull())
return new nettools.ui.Size(null);return new nettools.ui.Size(Math.abs(this.size)+this.unit)}
toString(){if(this.isNull())
return'';return this.size+this.unit}
add(value){if(this.isNull())
return new nettools.ui.Size(null);if(value instanceof nettools.ui.Size)
if(this.unit===value.unit)
return new nettools.ui.Size(this.size+value.size+this.unit);else throw new Error('Cannot add a Size object to another with different units');else return new nettools.ui.Size(this.size+Number(value)+this.unit)}
subtract(value){if(this.isNull())
return new nettools.ui.Size(null);if(value instanceof nettools.ui.Size)
if(this.unit===value.unit)
return new nettools.ui.Size(this.size-value.size+this.unit);else throw new Error('Cannot subtract a Size object from another with different units');else return new nettools.ui.Size(this.size-Number(value)+this.unit)}}
nettools.ui.FormBuilder=(function(){function __preventDefault(event){event.preventDefault()}
function _createLabel(name,id,field,after){var label=document.createElement('label');label.innerHTML=(after?' ':'')+nettools.jscore.firstUpperCase(field.label?field.label:name)+(after?'':' : ');label.style.verticalAlign='top';if(id)
label.setAttribute('for',id);if(field.newLineAfterLabel)
label.innerHTML=label.innerHTML+'<br>';return label}
function _createField(field,name,params){if((field.type===null)||(field.type===undefined))
field.type='text';var div=document.createElement('span');div.className="FormBuilderField";var unid=name+nettools.jscore.randomNumber();if((field.type!=='checkbox')&&(field.type!=='radio')&&((field.nolabel===undefined)||!field.nolabel))
div.appendChild(_createLabel(name,unid,field));if(field.autocomplete&&(field.type=='select'))
field.type='text';switch(field.type){case "select":var e=document.createElement('select');var opt=field.options||[];var optl=opt.length;for(var i=0;i<optl;i++){if(typeof opt[i]==='object')
e.options[i]=new Option(opt[i].label||opt[i].value,opt[i].value);else e.options[i]=new Option(opt[i],opt[i]);if(opt[i].className)
e.options[i].className=opt[i].className}
break;case "textarea":var e=document.createElement('textarea');break;case "image":var e=document.createElement('img');e.src=field.value;break;case "text":default:var e=document.createElement('input');e.type=field.type}
e.name=name;e.id=unid;e.setAttribute('data-formBuilderType',e.type);if(field.label)
e.title=field.label;if(field.title)
e.title=field.title;if(field.placeholder)
e.placeholder=field.placeholder;if(field.readonly)
if(field.type!='text'){e.onmousedown=__preventDefault;e.setAttribute('readonly','readonly')}else e.readOnly=field.readonly;if((field.type==='date')&&(e.type=='text'))
field.regexp=/^[0-9]{4}-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])$/;if(field.type!=='image')
e.value=(field.value!==undefined)?field.value:'';params.required=params.required||[];params.regexps=params.regexps||{};if(field.required)
params.required.push(name);if(field.regexp)
params.regexps[name]=field.regexp;if(params.required.indexOf(name)!=-1)
e.required=!0;if(params.regexps[name]){e.pattern=params.regexps[name].source;switch(e.getAttribute('data-formBuilderType')){case 'email':e.title=nettools.ui.FormBuilder.i18n.PATTERN_EMAIL;break;case 'date':e.title=nettools.ui.FormBuilder.i18n.PATTERN_DATE;break;case 'tel':e.title=nettools.ui.FormBuilder.i18n.PATTERN_TEL;break;case 'number':e.title=nettools.ui.FormBuilder.i18n.PATTERN_NUMBER;break}}
if(field.className)
e.className=field.className;if(field.style){var styles=field.style.split(";");for(var s=0;s<styles.length;s++)
if(nettools.jscore.trim(styles[s])!==''){var st=styles[s].split(':');var sty=nettools.jscore.trim(st[0]);var p=sty.indexOf('-');if(p!=-1)
sty=sty.substring(0,p)+sty.substr(p+1,1).toUpperCase()+sty.substr(p+2);e.style[sty]=nettools.jscore.trim(st[1])}}
div.appendChild(e);if((e.type==='checkbox')||(e.type==='radio')){e.checked=field.checked;if(!field.nolabel)
div.appendChild(_createLabel(name,unid,field,!0));}
if(e.type==='hidden'){div.style.visibility="hidden";div.style.display="none"}
if(field.autocomplete){new Awesomplete(e,{list:field.options||[],tabSelect:!0,autoFirst:!0,maxItems:15,sort:function(a,b){return(a<b)?-1:1},filter:Awesomplete.FILTER_STARTSWITH});if(field.listWidth)
e.nextElementSibling.style.width=field.listWidth;var tmp=document.createElement('input');tmp.type='hidden';tmp.name=e.name+'__value';tmp.value='';div.appendChild(tmp);e.addEventListener('awesomplete-selectcomplete',function(o){tmp.value=o.text.value?o.text.value:o.text.label;e.value=o.text.label})}
if(typeof field.onchange=='function'){if(field.autocomplete)
e.addEventListener('awesomplete-selectcomplete',function(o){field.onchange.call(e,o.text.value,o.text.label)});else e.addEventListener('change',field.onchange)}
return div}
function _createButtons(params){var div=document.createElement('div');var btn=document.createElement('input');btn.type='submit';btn.value=nettools.ui.FormBuilder.i18n.BUTTON_ACCEPT;btn.name="submit_button";div.appendChild(btn);var btn=document.createElement('input');btn.type='button';btn.value=nettools.ui.FormBuilder.i18n.BUTTON_CANCEL;btn.name="cancel_button";btn.onclick=function(e){if(params.cancel&&(typeof params.cancel==='function'))
params.cancel(params.target);};div.appendChild(btn);div.className="FormBuilderButtons";return div}
function _newLineBefore(field,container,params){if(field.newLineBefore){if(container.hasChildNodes()){params.target.appendChild(container);return document.createElement('div')}}
return container}
return{EMAIL:'email',TEXT:'text',NUMBER:'number',DATE:'date',TEL:'tel',createForm:function(params){params.fields=params.fields||{};params.target=params.target||document.createElement('form');if(params.name)
params.target.name=params.name;params.target.classList.add('FormBuilder');if(params.notice){var div=document.createElement('div');div.innerHTML=params.notice;div.classList.add('notice');params.target.appendChild(div)}
var curr_container=document.createElement('div');for(var f in params.fields){var field=params.fields[f];curr_container=_newLineBefore(field,curr_container,params);if(field.type==='radio'){if(field.label)
curr_container.appendChild(_createLabel(f,null,field,!1));for(var r in field.items){var fradio=field.items[r];fradio.type='radio';curr_container=_newLineBefore(fradio,curr_container,params);var frad=_createField(fradio,f,params);curr_container.appendChild(frad);params.target.elements[f+'_radio']=params.target.elements[f+'_radio']||{};params.target.elements[f+'_radio'][fradio.name]=frad.getElementsByTagName('input')[0]}}else curr_container.appendChild(_createField(field,f,params))}
params.target.appendChild(curr_container);params.target.appendChild(_createButtons(params));params.target.onsubmit=function(e){var _formValidator=new nettools.jscore.validator.FormValidator(params);if(params.presubmit&&(typeof params.presubmit==='function'))
params.presubmit(params.target.elements);var st=_formValidator.isValid(params.target.elements);var sub=nettools.jscore.SubmitHandlers.Callback.toSubmitHandler(params.submit);if(st.constructor&&(st.constructor.name==='Promise'))
st.then(function(st){if(sub)
sub.submit(params.target,params.target.elements);}).catch(function(e){if(e instanceof Error)
nettools.jscore.RequestHelper.promiseErrorHandler(e);});else if(st.status)
sub.submit(params.target,params.target.elements);return!1};return params.target},jsonToFields:function(str){var ret=JSON.parse(str);if(!ret)
return{};for(var field in ret)
ret[field]={type:'text',value:ret[field]};return ret}}})();nettools.ui.FormBuilder.i18n={PATTERN_EMAIL:'Valid email address (no accent, no space)',PATTERN_DATE:'Date with format yyyy-mm-dd',PATTERN_TEL:'Any valid phone number',PATTERN_NUMBER:'Any integer',BUTTON_ACCEPT:'Accept',BUTTON_CANCEL:'Cancel'}
nettools.ui.window={popup:function(url,name,w,h,scrollbars){if((scrollbars===undefined)||(scrollbars===null))
scrollbars=!1;var px=Math.round((screen.width-w-16)/2);var py=Math.round((screen.height-h-74)/2);var wnd=window.open(url,name,'toolbar=0,scrollbars='+(scrollbars?"1":"0")+',statusbar=0,menubar=0,resizable=1,top='+py+'screenY='+py+',left='+px+',screenX='+px+',width='+w+',height='+h);return wnd},fermer:function(){var obj_window=window.open('','_self');obj_window.opener=window;obj_window.focus();opener=self;self.close()},hasPopupBlocker:function(poppedWindow){var result=!1;try{if(typeof poppedWindow==='undefined'){result=!0}else if(poppedWindow&&poppedWindow.closed){result=!1}else if(poppedWindow&&poppedWindow.com.ui.desktop.util.window){if(Number(poppedWindow.outerHeight)===0)
result=!0;else result=!1}else{result=!0}}catch(err){}
return result}}